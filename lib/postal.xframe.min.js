/*
 postal.xframe
 Copyright (C) 2012 - Jim Cowart (http://freshbrewedcode.com/jimcowart)
 License: Dual licensed MIT & GPL v2.0
 Version 0.1.0
 */
(function(e,t){typeof module=="object"&&module.exports?module.exports=t(require("underscore"),require("postal.federation")):typeof define=="function"&&define.amd?define(["underscore","postal.federation"],function(n,r){return t(n,r,e)}):e.postal=t(e._,e.postal,e)})(this,function(e,t,n,r){var i=function(e,t,n){var r="xframe",i=!0,s={autoReciprocate:!0,allowedOrigins:[e.location.origin],originUrl:e.location.origin},o=s,u={config:function(e){return e&&(o=t.defaults(e,s)),o},clientOptionsFromEvent:function(e){var t=this,i=e.data,s={id:i.instanceId,type:r,send:function(t){e.source.postMessage(t,o.originUrl||"*")}};return o.autoReciprocate&&(s.postSetup=function(){n.fedx.clients[i.instanceId].send(n.fedx.getFedxWrapper("ready"),r)}),s},disable:function(){i=!1},enable:function(){i=!0},getTargets:function(){return t.map(document.getElementsByTagName("iframe"),function(e){return e.contentWindow})},onPostMessage:function(e){console.log(e.data);if(this.shouldProcess(e)){var t=e.data;t.type==="ready"?n.fedx.addClient(this.clientOptionsFromEvent(e)):n.fedx.onFederatedMsg(t,t.instanceId)}},shouldProcess:function(e){var n=!!o.allowedOrigins.length;return i&&(n&&t.contains(o.allowedOrigins,e.origin)||!n)&&e.data.postal},signalReady:function(r){var i=this,s=i.getTargets();e.parent&&e.parent!==e&&s.push(e.parent),t.each(s,function(e){e.postMessage(n.fedx.getFedxWrapper("ready"),o.originUrl||"*")})}};t.bindAll(u),n.fedx.transports.xframe=u,e.addEventListener("message",u.onPostMessage,!1)}(window,e,t);return t})