/*
 postal.xframe
 Copyright (C) 2012 - Jim Cowart (http://freshbrewedcode.com/jimcowart)
 License: Dual licensed MIT & GPL v2.0
 Version 0.1.0
 */
(function(e,t){typeof module=="object"&&module.exports?module.exports=t(require("underscore"),require("postal.federation")):typeof define=="function"&&define.amd?define(["underscore","postal.federation"],function(n,r){return t(n,r,e)}):e.postal=t(e._,e.postal,e)})(this,function(e,t,n,r){var i=function(e,t,n){var r="xframe",i={autoReciprocate:!0,allowedOrigins:[e.location.origin],enabled:!0,originUrl:e.location.origin},s=i,o={config:function(e){return e&&(s=t.defaults(e,i)),s},clientOptionsFromEvent:function(e){var t=this,i=e.data,o={id:i.instanceId,type:r,send:function(t){e.source.postMessage(t,s.originUrl||"*")}};return s.autoReciprocate&&(o.postSetup=function(){n.fedx.clients[i.instanceId].send(n.fedx.getFedxWrapper("ready"),r)}),o},getTargets:function(){var n=t.map(document.getElementsByTagName("iframe"),function(e){return e.contentWindow});return e.parent&&e.parent!==e&&n.push(e.parent),n},onPostMessage:function(e){console.log(e.data);if(this.shouldProcess(e)){var t=e.data;t.type==="ready"?n.fedx.addClient(this.clientOptionsFromEvent(e)):n.fedx.onFederatedMsg(t,t.instanceId)}},shouldProcess:function(e){var n=!!s.allowedOrigins.length;return s.enabled&&(n&&t.contains(s.allowedOrigins,e.origin)||!n)&&e.data.postal},signalReady:function(e){t.each(this.getTargets(),function(e){e.postMessage(n.fedx.getFedxWrapper("ready"),s.originUrl||"*")})}};t.bindAll(o),n.fedx.transports.xframe=o,e.addEventListener("message",o.onPostMessage,!1)}(window,e,t);return t})