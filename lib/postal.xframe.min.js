/*
 postal.xframe
 Copyright (C) 2012 - Jim Cowart (http://freshbrewedcode.com/jimcowart)
 License: Dual licensed MIT & GPL v2.0
 Version 0.1.0
 */
(function(e,t){typeof module=="object"&&module.exports?module.exports=t(require("underscore"),require("postal.federation")):typeof define=="function"&&define.amd?define(["underscore","postal.federation"],function(n,r){return t(n,r,e)}):e.postal=t(e._,e.postal,e)})(this,function(e,t,n,r){var i="xframe",s={allowedOrigins:[window.location.origin],enabled:!0,originUrl:window.location.origin},o=s,u=function(e,t){this.source=e,this.instanceId=t};u.prototype.send=function(e){a.send(this.source,e)};var a=t.fedx.transports[i]={XFrameClient:u,config:function(t){return t&&(o=e.defaults(t,s)),o},getClientInstance:function(e){return new u(e.source,e.packingSlip.instanceId)},getTargets:function(){var t=e.map(document.getElementsByTagName("iframe"),function(e){return e.contentWindow});return window.parent&&window.parent!==window&&t.push(window.parent),t},wrap:function(e){return{postal:!0,packingSlip:e}},unwrap:function(e){return e.packingSlip},onMessage:function(e){if(this.shouldProcess(e)){var n=this.unwrap(e.data);t.fedx.onFederatedMsg({transport:i,packingSlip:n,source:e.source})}},send:function(e,t){e.postMessage(this.wrap(t),o.originUrl)},shouldProcess:function(t){var n=!!o.allowedOrigins.length;return o.enabled&&(n&&e.contains(o.allowedOrigins,t.origin)||!n)&&t.data.postal}};return e.bindAll(a),window.addEventListener("message",a.onMessage,!1),t})